# 二维码兑换码系统

一个基于Flask的二维码兑换码管理系统，支持通过扫描二维码领取兑换码，每个兑换码只能领取一次。

## 功能特点

- 🎯 **二维码生成**: 自动生成访问链接的二维码
- 📱 **移动端友好**: 响应式设计，支持手机扫码访问
- 🔒 **防重复领取**: 每个兑换码只能被领取一次
- 📊 **实时统计**: 实时显示兑换码使用情况
- 🔧 **管理后台**: 完整的后台管理功能
- 📁 **CSV导入**: 支持上传自定义CSV文件
- 🔄 **状态重置**: 可以重置所有兑换码状态

## 安装和运行

### 本地开发环境

#### 1. 安装依赖

```bash
pip install -r requirements.txt
```

#### 2. 运行应用

```bash
python app.py
# 或者使用启动脚本
./start.sh
```

#### 3. 访问系统

- **主页（二维码页面）**: http://localhost:5001
- **管理后台**: http://localhost:5001/admin

### 生产环境部署

#### 方案1: 快速公网部署（推荐测试）

```bash
# 运行部署脚本
./deploy.sh
# 选择方案1: ngrok公网部署
```

#### 方案2: Docker部署

```bash
# 构建并运行Docker容器
docker-compose up -d

# 或者手动构建
docker build -t qrcode-system .
docker run -p 80:80 qrcode-system
```

#### 方案3: 云服务器部署

1. 上传代码到云服务器
2. 安装依赖: `pip install -r requirements.txt`
3. 运行生产版本: `python app_production.py`
4. 配置防火墙开放80端口
5. 通过公网IP访问

#### 方案4: 本地网络部署

```bash
./deploy.sh
# 选择方案2: 本地网络部署
# 其他人通过你的局域网IP访问
```

## 使用说明

### 用户端使用

1. 访问主页查看二维码
2. 用手机扫描二维码
3. 点击"立即领取"按钮
4. 获得专属兑换码

### 管理员使用

1. 访问管理后台 `/admin`
2. 查看兑换码使用统计
3. 上传新的CSV文件（可选）
4. 重置兑换码状态（可选）
5. 下载当前CSV文件

## CSV文件格式

系统会自动创建示例CSV文件，格式如下：

```csv
code,status,claimed_time,claimed_by
CODE001,未领取,,
CODE002,未领取,,
CODE003,未领取,,
...
```

### 自定义CSV文件

你可以上传自己的CSV文件，系统会自动处理：
- 第一列必须是兑换码
- 其他列可选
- 系统会自动添加状态、领取时间、领取者ID等列

## 系统架构

```
qrcode/
├── app.py              # 主应用文件
├── requirements.txt    # 依赖包列表
├── codes.csv          # 兑换码数据文件
├── templates/         # HTML模板
│   ├── index.html     # 主页（二维码页面）
│   ├── claim.html     # 兑换码领取页面
│   └── admin.html     # 管理后台页面
├── static/            # 静态文件
│   └── qr_code.png    # 生成的二维码图片
└── README.md          # 项目说明
```

## API接口

### 领取兑换码
- **URL**: `/api/claim`
- **方法**: POST
- **返回**: JSON格式的领取结果

### 重置兑换码
- **URL**: `/admin/reset`
- **方法**: POST
- **功能**: 重置所有兑换码状态

### 上传CSV文件
- **URL**: `/admin/upload`
- **方法**: POST
- **功能**: 上传新的CSV文件

### 下载CSV文件
- **URL**: `/codes.csv`
- **方法**: GET
- **功能**: 下载当前CSV文件

## 技术栈

- **后端**: Flask (Python)
- **前端**: HTML5, CSS3, JavaScript
- **数据处理**: Pandas
- **二维码生成**: qrcode
- **图像处理**: Pillow

## 注意事项

1. 确保网络连接正常，二维码链接需要能够访问
2. 系统使用线程锁确保兑换码分配的原子性
3. CSV文件使用UTF-8编码
4. 建议在生产环境中使用更安全的配置

## 自定义配置

你可以修改 `app.py` 中的以下配置：

- `CSV_FILE`: CSV文件路径
- 端口号（默认5001）
- 主机地址（默认0.0.0.0）

## 故障排除

### 常见问题

1. **二维码无法扫描**: 检查网络连接和服务器地址
2. **CSV文件上传失败**: 确保文件格式正确（.csv后缀）
3. **兑换码重复领取**: 检查CSV文件格式和系统状态

### 日志查看

系统会在控制台输出运行日志，包括：
- 兑换码分配情况
- 文件操作状态
- 错误信息

## 许可证

MIT License 